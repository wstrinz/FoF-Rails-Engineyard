/*
 * File: app/view/InformationPanel.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */



Ext.define('Biofuels.view.InformationPanel', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.informationPanel',
    requires: [
        'Biofuels.view.DisplayBox',
    ],

/*    height: 587,
    width: 689,*/
/*    layout: {
        type: 'accordion',
        titleCollapse: false,
    },*/
    title: 'Information About Your Farm',
    titleAlign: 'center',

    //--------------------------------------------------------------------------
    initNetworkEvents: function() {
      var app = Biofuels;

        app.network.registerListener('joinRoom', this.joinedRoom, this);
        app.network.registerListener('getFarmInfo', this.refreshRanks, this);
        app.network.registerListener('getFarmerHistory', this.refreshGraphs, this);
        app.network.registerListener('getLatestFarmerHistory', this.updateGraphs, this);
        // app.network.registerListener('getFarmInfo', this.loadFarmInfo, this);
    },

    //--------------------------------------------------------------------------
    joinedRoom: function(json) {
      this.setTitle("Information About " + json.userName + "'s Farm");
    },

    refreshRanks: function(json){
      Ext.getCmp("sustainability-score").setText(Math.round(json.sustainabilityScore * 100) / 100)
      Ext.getCmp("sustainability-rank").setText(json.sustainabilityRank)
      Ext.getCmp("economics-score").setText(Math.round(json.economicsScore * 100) / 100)
      Ext.getCmp("economics-rank").setText(json.economicsRank)
      Ext.getCmp("environment-score").setText(Math.round(json.environmentScore * 100) / 100)
      Ext.getCmp("environment-rank").setText(json.environmentRank)
      Ext.getCmp("energy-score").setText(Math.round(json.energyScore * 100) / 100)
      Ext.getCmp("energy-rank").setText(json.energyRank)
    },

    refreshGraphs: function(json){
      Ext.data.StoreManager.lookup('environmentHistoryStore').removeAll();
      Ext.data.StoreManager.lookup('sustainabilityStore').removeAll();
      Ext.data.StoreManager.lookup('farmYieldStore').removeAll();
      Ext.data.StoreManager.lookup('farmEnergyStore').removeAll();
      Ext.data.StoreManager.lookup('economicsStore').removeAll();

      const CORNENERGY_S = 37601;
      const CORNENERGY_I = 17700;
      const GRASSENERGY = 17700;
      const CORNPRICE = 200;
      const GRASSPRICE = 100;

      for (var i = 0; i < json.years.length; i++) {
        var thisYear = json.years[i];
        var envData = {
          'year': thisYear.year,
          'rank': thisYear.environmentRank,
          'soil': Math.round(thisYear.soilSubscore * 100) / 100,
          'water': Math.round(thisYear.waterSubscore * 100) / 100,
        }

        var sustainData = {
          'year': thisYear.year,
          'rank': thisYear.sustainabilityRank,
          'environment': Math.round(thisYear.environmentScore * 100) / 100,
          'economy': Math.round(thisYear.economicsScore * 100) / 100,
          'energy': Math.round(thisYear.energyScore * 100) / 100,
        }

        var yieldData = {
          'year': thisYear.year,
        }
        if(thisYear.cornYield > 0){
          yieldData.corn = Math.round(thisYear.cornYield * 100) / 100;
        }
        if(thisYear.grassYield > 0){
          yieldData.grass = Math.round(thisYear.grassYield * 100) / 100;
        }

        var energyData = {
          'year': thisYear.year,
        }
        if(thisYear.cornYield > 0){
          energyData.corn = Math.round((CORNENERGY_S * thisYear.cornYield + CORNENERGY_I) * 100) / 100;
        }
        if(thisYear.grassYield > 0){
          energyData.grass = Math.round((GRASSENERGY *  thisYear.grassYield) * 100) / 100;
        }

        var econData = {
          'year': thisYear.year,
          'corn': Math.round(thisYear.cornYield * CORNPRICE * 100) / 100,
          'grass': Math.round(thisYear.grassYield * GRASSPRICE * 100) / 100,
        }

/*
        if(thisYear.grassYield > 0){
          yieldData.grass = thisYear.grassYield
        }*/

        Ext.data.StoreManager.lookup('environmentHistoryStore').loadRawData(envData, true)
        Ext.data.StoreManager.lookup('sustainabilityStore').loadRawData(sustainData, true)
        Ext.data.StoreManager.lookup('farmYieldStore').loadRawData(yieldData, true)
        Ext.data.StoreManager.lookup('farmEnergyStore').loadRawData(energyData, true)
        Ext.data.StoreManager.lookup('economicsStore').loadRawData(econData, true)
      };
    },

    updateGraphs: function(json){
      // console.log("graphs")
      const CORNENERGY_S = 37601;
      const CORNENERGY_I = 17700;
      const GRASSENERGY = 17700;
      const CORNPRICE = 200;
      const GRASSPRICE = 100;

      var thisYear = json.yearInfo;
      var envData = {
        'year': thisYear.year,
        'id': thisYear.year,
        'rank': thisYear.environmentRank,
        'soil': Math.round(thisYear.soilSubscore * 100) / 100,
        'water': Math.round(thisYear.waterSubscore * 100) / 100,
      }

      var sustainData = {
        'year': thisYear.year,
        'id': thisYear.year,
        'rank': thisYear.sustainabilityRank,
        'environment': Math.round(thisYear.environmentScore * 100) / 100,
        'economy': Math.round(thisYear.economicsScore * 100) / 100,
        'energy': Math.round(thisYear.energyScore * 100) / 100,
      }

      var yieldData = {
        'year': thisYear.year,
        'id': thisYear.year,
      }
      if(thisYear.cornYield > 0){
        yieldData.corn = Math.round(thisYear.cornYield * 100) / 100;
      }
      if(thisYear.grassYield > 0){
        yieldData.grass = Math.round(thisYear.grassYield * 100) / 100;
      }

      var energyData = {
        'year': thisYear.year,
        'id': thisYear.year,
      }
      if(thisYear.cornYield > 0){
        energyData.corn = Math.round((CORNENERGY_S * thisYear.cornYield + CORNENERGY_I) * 100) / 100;
      }
      if(thisYear.grassYield > 0){
        energyData.grass = Math.round((GRASSENERGY *  thisYear.grassYield) * 100) / 100;
      }

      var econData = {
        'year': thisYear.year,
        'corn': Math.round(thisYear.cornYield * CORNPRICE * 100) / 100,
        'grass': Math.round(thisYear.grassYield * GRASSPRICE * 100) / 100,
        'id': thisYear.year,
      }

/*
      if(thisYear.grassYield > 0){
        yieldData.grass = thisYear.grassYield
      }*/

      Ext.data.StoreManager.lookup('environmentHistoryStore').loadRawData(envData, true)
      Ext.data.StoreManager.lookup('sustainabilityStore').loadRawData(sustainData, true)
      Ext.data.StoreManager.lookup('farmYieldStore').loadRawData(yieldData, true)
      Ext.data.StoreManager.lookup('farmEnergyStore').loadRawData(energyData, true)
      Ext.data.StoreManager.lookup('economicsStore').loadRawData(econData, true)

    },

    initComponent: function() {
        var me = this;

        // var bdisp = Ext.create('Biofuels.view.DisplayBox');


/*        this.fieldHistoryStore2 = Ext.create('Ext.data.JsonStore', {
            storeId: 'historyStore2',
            fields: ['year','corn','grass'],
            data: [
              {'year':0, 'corn':10, 'grass':20},
              {'year':1, 'corn':20, 'grass':40},
              {'year':2, 'corn':30, 'grass':10},
            ]
        });*/

        this.environmentStore = Ext.create('Ext.data.JsonStore', {
            storeId: 'environmentHistoryStore',
            fields: ['year','soil','water', 'rank'],

            data: [
              /*{'year':0, 'soil':10, 'water':20, 'rank':3},
              {'year':1, 'soil':20, 'water':40, 'rank':1},
              {'year':2, 'soil':30, 'water':10, 'rank':2},*/
            ]
        });

        this.sustainabilityStore = Ext.create('Ext.data.JsonStore', {
            storeId: 'sustainabilityStore',
            fields: ['year','environment','economy', 'energy', 'rank'],
            data: [
              /*{'year':0, 'environment':10, 'economy':20, 'energy':20, 'rank':3},
              {'year':1, 'environment':20, 'economy':40, 'energy':40, 'rank':1},
              {'year':2, 'environment':30, 'economy':10, 'energy':10, 'rank':2},*/
            ]
        });

        this.farmYieldStore = Ext.create('Ext.data.JsonStore', {
            storeId: 'farmYieldStore',
            fields: ['year','corn','grass'],



            data: [
              /*{'year':0, 'corn':1, 'grass':20},
              {'year':1, 'corn':25, 'grass':4},
              {'year':2, 'corn':8, 'grass':10},*/
            ]
        });

        this.farmEnergyStore = Ext.create('Ext.data.JsonStore', {
            storeId: 'farmEnergyStore',
            fields: ['year','corn','grass'],

            data: [
              /*{'year':0, 'corn':14, 'grass':30},
              {'year':1, 'corn':2, 'grass':9},
              {'year':2, 'corn':82, 'grass':40},*/
            ]
        });

        this.EconStore = Ext.create('Ext.data.JsonStore', {
            storeId: 'economicsStore',
            fields: ['year','corn','grass'],

            data: [
             /* {'year':0, 'corn':14, 'grass':30},
              {'year':1, 'corn':2, 'grass':9},
              {'year':2, 'corn':82, 'grass':40},*/
            ]
        });



        this.initNetworkEvents();

        Ext.applyIf(me, {
            items: [

            //========================================================
            // Sustainability Panel
            //========================================================
                {
                    xtype: 'panel',
                    collapsed: false,
                    title: 'Sustainability',
                    cls: 'my-panel',
                    collapseFirst: false,
                    layout: 'fit',

                    tools: [
                      {
                        xtype: 'dispbox',
                        blable: 'Score',
                        btip: ' = (Environmental Score + Economic Score + Energy Score) / 3',
                        id: 'sustainability-score'
                      },
                      {
                        xtype: 'tbspacer', width: 135
                      },
                      {
                        xtype: 'dispbox',
                        blable: 'Rank',
                        id: 'sustainability-rank'
                      },
                      {
                        xtype: 'tbspacer', width: 50
                      },
                    ],
                    items: [
                    {
                      xtype: 'container',
                      layout: 'fit',
                      items: [
                          {
                            xtype: 'chart',
                            // height: 226,
                            // width: 404,
                            animate: true,
                            insetPadding: 20,
                            store: 'sustainabilityStore',
                            theme: 'Category4',
                            legend: {
                              position: 'right'
                            },
                            axes: [
                                {
                                    type: 'Category',
                                    fields: [
                                        'year'
                                    ],
                                    position: 'bottom',
                                    title: 'Year'
                                },
                                {
                                    type: 'Numeric',
                                    fields: [
                                        'y'
                                    ],
                                    position: 'left',
                                    title: 'Score'
                                }
                            ],
                            series: [
                                {
                                    type: 'column',
                                    label: {
                                        display: 'outside',
                                        field: 'rank',
                                    },
                                    xField: 'year',
                                    yField: [
                                        'environment',
                                        'economy',
                                        'energy',
                                    ],
                                    stacked: true,
                                    tips: {
                                      trackMouse: true,
                                      width: 105,
                                      height: 90,
                                      layout: 'fit',
                                      renderer: function(storeItem, item) {
                                        this.setTitle("\n energy: " + storeItem.get("energy") + "\n economy: " + storeItem.get("economy") + "\n environment: " + storeItem.get("environment"));
                                      },
                                    },
                                }
                              ]
                            }
                          ]
                        }
                    ]
                },

                //========================================================
                // Economics Panel
                //========================================================
                {
                    xtype: 'panel',
                    collapsed: true,
                    collapseFirst: false,
                    title: 'Economics',
                    layout: 'fit',
                    tools: [
                      {
                        xtype: 'dispbox',
                        blable: '$',
                        id: 'economics-score'
                      },
                      {
                        xtype: 'tbspacer', width: 135
                      },
                      {
                        xtype: 'dispbox',
                        blable: 'Rank',
                        id: 'economics-rank'
                      },
                      {
                        xtype: 'tbspacer', width: 50
                      },
                    ],
                    items: [
                              {
                                xtype: 'chart',
                                theme: 'Category5',
                                store: 'economicsStore',
                                animate: true,
                                legend: {
                                  position: 'right'
                                },
                                axes: [{
                                    type: 'Numeric',
                                    position: 'left',
                                    fields: ['corn','grass'],
                                    title: 'Profit',
                                    minimum: 0,
                                    adjustMinimumByMajorUnit: 0
                                }, {
                                    type: 'Category',
                                    position: 'bottom',
                                    fields: ['year'],
                                    title: 'Year',
                                    grid: true,
                                    label: {
                                        rotate: {
                                            degrees: 315
                                        }
                                    }
                                }],
                                series: [{
                                    type: 'area',
                                    axis: 'left',
                                    xField: 'year',
                                    yField: ['grass', 'corn'],
                                    tips: {
                                            trackMouse: true,
                                            width: 90,
                                            height: 90,
                                            layout: 'fit',
                                            renderer: function(storeItem, item) {
                                              this.setTitle("year: " + storeItem.get("year") + "\n corn: " + storeItem.get("corn") +
                                                "\n grass: " + storeItem.get("grass") );
                                            },
                                          },
                                    style: {
                                        opacity: 0.93
                                    }
                                }]
                              }
                            ],
                    },

                    //========================================================
                    // Energy Panel
                    //========================================================

                    {
                    xtype: 'panel',
                    collapsed: true,
                    collapseFirst: false,
                    title: 'Energy',
                    layout: 'fit',

                    tools: [
                      {
                        xtype: 'dispbox',
                        blable: 'Score',
                        id: 'energy-score',
                        btip: ' = Energy Produced / Maximum Energy',
                      },
                      {
                        xtype: 'tbspacer', width: 135
                      },
                      {
                        xtype: 'dispbox',
                        blable: 'Rank',
                        id: 'energy-rank'
                      },
                      {
                        xtype: 'tbspacer', width: 50
                      },
                    ],
                    items: [
                    {
                      xtype: 'tabpanel',
                      layout: 'fit',
                      activeTab: 0,
                      items: [
                        {
                          xtype: 'panel',
                          title: 'Yield',
                          layout: 'fit',
                          items: [
                              {
                                  xtype: 'chart',
                                  animate: true,
                                  theme: 'Category5',
                                  insetPadding: 20,
                                  store: 'farmYieldStore',
                                  legend: {
                                    position: 'bottom'
                                  },
                                  axes: [
                                      {
                                          type: 'Category',
                                          fields: [
                                              'year'
                                          ],
                                          position: 'bottom',
                                          title: 'Year'
                                      },
                                      {
                                          type: 'Numeric',
                                          fields: [
                                              'corn',
                                              'grass'
                                          ],
                                          position: 'left',
                                          title: 'Yield'
                                      }
                                  ],
                                  series: [
                                      {
                                          type: 'line',
                                          highlight: {
                                             size: 4,
                                             radius: 6
                                          },
                                          xField: 'year',
                                          yField: [
                                              'grass', 'corn'
                                          ],
                                          smooth: 3,
                                          tips: {
                                            trackMouse: true,
                                            width: 90,
                                            height: 55,
                                            layout: 'fit',
                                            renderer: function(storeItem, item) {
                                              this.setTitle("year: " + storeItem.get("year") + "\n grass: " + storeItem.get("grass")) +
                                               "\n corn: " + storeItem.get("corn");
                                            },
                                          },
                                      },
                                      /*{
                                          type: 'line',
                                          highlight: {
                                             size: 4,
                                             radius: 6
                                          },
                                          xField: 'year',
                                          yField: [
                                              'corn'
                                          ],
                                          smooth: 3,
                                          tips: {
                                            trackMouse: true,
                                            width: 90,
                                            height: 55,
                                            layout: 'fit',
                                            renderer: function(storeItem, item) {
                                              this.setTitle("year: " + storeItem.get("year") + "\n yield: " + storeItem.get("corn"));
                                            },
                                          },
                                      },*/

                                  ]
                              }
                          ]
                        },
                        {
                          xtype: 'panel',
                          title: 'Energy',
                          layout: 'fit',
                          items: [
                              {
                                  xtype: 'chart',
                                  animate: true,
                                  insetPadding: 20,
                                  theme: 'Category5',
                                  store: 'farmEnergyStore',
                                  legend: {
                                    position: 'bottom'
                                  },
                                  axes: [
                                      {
                                          type: 'Category',
                                          fields: [
                                              'year'
                                          ],
                                          position: 'bottom',
                                          title: 'Year'
                                      },
                                      {
                                          type: 'Numeric',
                                          fields: [
                                              'corn',
                                              'grass'
                                          ],
                                          position: 'left',
                                          title: 'Energy'
                                      }
                                  ],
                                  series: [
                                      {
                                          type: 'line',
                                          highlight: {
                                             size: 4,
                                             radius: 6
                                          },
                                          xField: 'year',
                                          yField: [
                                              'grass'
                                          ],
                                          smooth: 3,
                                          tips: {
                                            trackMouse: true,
                                            width: 90,
                                            height: 80,
                                            layout: 'fit',
                                            renderer: function(storeItem, item) {
                                              this.setTitle("year: " + storeItem.get("year") + "\n energy(MJ): " + storeItem.get("grass"));
                                            },
                                          },
                                      },
                                      {
                                          type: 'line',
                                          highlight: {
                                             size: 4,
                                             radius: 6
                                          },
                                          xField: 'year',
                                          yField: [
                                              'corn'
                                          ],
                                          smooth: 3,
                                          tips: {
                                            trackMouse: true,
                                            width: 90,
                                            height: 80,
                                            layout: 'fit',
                                            renderer: function(storeItem, item) {
                                              this.setTitle("year: " + storeItem.get("year") + "\n energy(MJ): " + storeItem.get("corn"));
                                            },
                                          },
                                      },
                                  ]
                              }
                            ]
                        }
                      ]
                    }
                  ]
              },

                //========================================================
                // Environment Panel
                //========================================================
                {
                    xtype: 'panel',
                    collapsed: true,
                    collapseFirst: false,
                    title: 'Environment',
                    layout: 'fit',
                    tools: [
                      {
                        xtype: 'dispbox',
                        blable: 'Score',
                        id: 'environment-score',
                        btip: ' = [ (Avg Soil Health / Max Soil Health) + Phosphorous Score ] / 2',
                      },
                      {
                        xtype: 'tbspacer', width: 135
                      },
                      {
                        xtype: 'dispbox',
                        blable: 'Rank',
                        id: 'environment-rank'
                      },
                      {
                        xtype: 'tbspacer', width: 50
                      },
                    ],
                    items: [
                      {
                        xtype: 'container',
                        layout: 'fit',
                        items: [
                            {
                              xtype: 'chart',
                              // height: 226,
                              // width: 404,
                              animate: true,
                              insetPadding: 20,
                              store: 'environmentHistoryStore',
                              theme: 'Category5',
                              legend: {
                                position: 'right'
                              },
                              axes: [
                                  {
                                      type: 'Category',
                                      fields: [
                                          'year'
                                      ],
                                      position: 'bottom',
                                      title: 'Year'
                                  },
                                  {
                                      type: 'Numeric',
                                      fields: [
                                          'y'
                                      ],
                                      position: 'left',
                                      title: 'Score'
                                  }
                              ],
                              series: [
                                  {
                                      type: 'column',
                                      label: {
                                          display: 'outside',
                                          field: 'rank',
                                      },
                                      xField: 'year',
                                      yField: [
                                          'soil',
                                          'water',
                                      ],
                                      stacked: true,
                                      tips: {
                                        trackMouse: true,
                                        width: 90,
                                        height: 60,
                                        layout: 'fit',
                                        renderer: function(storeItem, item) {
                                          this.setTitle("water: " + storeItem.get("water") + "\n soil: " + storeItem.get("soil"));
                                        },
                                      },
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                },
                //========================================================
                // Log Panel
                //========================================================
                {
                    xtype: 'panel',
                    collapseFirst: false,
                    collapsed: true,
                    title: 'Log',
                    id: 'LogPanel',
                    autoScroll: true,
                }
            ]
        });

        me.callParent(arguments);
    }

});